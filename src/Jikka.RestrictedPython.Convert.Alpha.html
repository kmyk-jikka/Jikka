<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Jikka.RestrictedPython.Convert.Alpha</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#run"><span class="hs-identifier">run</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">delete</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intersect</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html"><span class="hs-identifier">Jikka.Common.Alpha</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.Common.Error.html"><span class="hs-identifier">Jikka.Common.Error</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Builtin.html"><span class="hs-identifier">Jikka.RestrictedPython.Language.Builtin</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html"><span class="hs-identifier">Jikka.RestrictedPython.Language.Expr</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Lint.html"><span class="hs-identifier">Jikka.RestrictedPython.Language.Lint</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Util.html"><span class="hs-identifier">Jikka.RestrictedPython.Language.Util</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.VariableAnalysis.html"><span class="hs-identifier">Jikka.RestrictedPython.Language.VariableAnalysis</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">data</span><span> </span><span id="Env"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="currentMapping"><span class="annot"><span class="annottext">Env -&gt; [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var hs-var">currentMapping</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span id="parentMappings"><span class="annot"><span class="annottext">Env -&gt; [[(VarName, VarName)]]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#parentMappings"><span class="hs-identifier hs-var hs-var">parentMappings</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679328281"><span id="local-6989586621679328283"><span class="annot"><span class="annottext">Env -&gt; Env -&gt; Bool
(Env -&gt; Env -&gt; Bool) -&gt; (Env -&gt; Env -&gt; Bool) -&gt; Eq Env
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Env -&gt; Env -&gt; Bool
$c/= :: Env -&gt; Env -&gt; Bool
== :: Env -&gt; Env -&gt; Bool
$c== :: Env -&gt; Env -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679328265"><span id="local-6989586621679328267"><span id="local-6989586621679328269"><span id="local-6989586621679328271"><span id="local-6989586621679328273"><span id="local-6989586621679328275"><span id="local-6989586621679328277"><span class="annot"><span class="annottext">Eq Env
Eq Env
-&gt; (Env -&gt; Env -&gt; Ordering)
-&gt; (Env -&gt; Env -&gt; Bool)
-&gt; (Env -&gt; Env -&gt; Bool)
-&gt; (Env -&gt; Env -&gt; Bool)
-&gt; (Env -&gt; Env -&gt; Bool)
-&gt; (Env -&gt; Env -&gt; Env)
-&gt; (Env -&gt; Env -&gt; Env)
-&gt; Ord Env
Env -&gt; Env -&gt; Bool
Env -&gt; Env -&gt; Ordering
Env -&gt; Env -&gt; Env
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: Env -&gt; Env -&gt; Env
$cmin :: Env -&gt; Env -&gt; Env
max :: Env -&gt; Env -&gt; Env
$cmax :: Env -&gt; Env -&gt; Env
&gt;= :: Env -&gt; Env -&gt; Bool
$c&gt;= :: Env -&gt; Env -&gt; Bool
&gt; :: Env -&gt; Env -&gt; Bool
$c&gt; :: Env -&gt; Env -&gt; Bool
&lt;= :: Env -&gt; Env -&gt; Bool
$c&lt;= :: Env -&gt; Env -&gt; Bool
&lt; :: Env -&gt; Env -&gt; Bool
$c&lt; :: Env -&gt; Env -&gt; Bool
compare :: Env -&gt; Env -&gt; Ordering
$ccompare :: Env -&gt; Env -&gt; Ordering
$cp1Ord :: Eq Env
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679328256"><span id="local-6989586621679328258"><span id="local-6989586621679328260"><span id="local-6989586621679328262"><span class="annot"><span class="annottext">ReadPrec [Env]
ReadPrec Env
Int -&gt; ReadS Env
ReadS [Env]
(Int -&gt; ReadS Env)
-&gt; ReadS [Env] -&gt; ReadPrec Env -&gt; ReadPrec [Env] -&gt; Read Env
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
readListPrec :: ReadPrec [Env]
$creadListPrec :: ReadPrec [Env]
readPrec :: ReadPrec Env
$creadPrec :: ReadPrec Env
readList :: ReadS [Env]
$creadList :: ReadS [Env]
readsPrec :: Int -&gt; ReadS Env
$creadsPrec :: Int -&gt; ReadS Env
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679328249"><span id="local-6989586621679328251"><span id="local-6989586621679328253"><span class="annot"><span class="annottext">Int -&gt; Env -&gt; ShowS
[Env] -&gt; ShowS
Env -&gt; String
(Int -&gt; Env -&gt; ShowS)
-&gt; (Env -&gt; String) -&gt; ([Env] -&gt; ShowS) -&gt; Show Env
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Env] -&gt; ShowS
$cshowList :: [Env] -&gt; ShowS
show :: Env -&gt; String
$cshow :: Env -&gt; String
showsPrec :: Int -&gt; Env -&gt; ShowS
$cshowsPrec :: Int -&gt; Env -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#initialEnv"><span class="hs-identifier hs-type">initialEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-27"></span><span id="initialEnv"><span class="annot"><span class="annottext">initialEnv :: Env
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#initialEnv"><span class="hs-identifier hs-var hs-var">initialEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="annottext">Env :: [(VarName, VarName)] -&gt; [[(VarName, VarName)]] -&gt; Env
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentMapping :: [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var">currentMapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>      </span><span class="annot"><span class="annottext">parentMappings :: [[(VarName, VarName)]]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#parentMappings"><span class="hs-identifier hs-var">parentMappings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(VarName -&gt; (VarName, VarName))
-&gt; [VarName] -&gt; [(VarName, VarName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679328246"><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679328246"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679328246"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679328246"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VarName -&gt; [VarName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set VarName
</span><a href="Jikka.RestrictedPython.Language.Builtin.html#builtinNames"><span class="hs-identifier hs-var">builtinNames</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span id="local-6989586621679328325"><span id="local-6989586621679328326"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#withToplevelScope"><span class="hs-identifier hs-type">withToplevelScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328326"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328326"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328325"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328325"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-34"></span><span id="withToplevelScope"><span class="annot"><span class="annottext">withToplevelScope :: m a -&gt; m a
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#withToplevelScope"><span class="hs-identifier hs-var hs-var">withToplevelScope</span></a></span></span><span> </span><span id="local-6989586621679328242"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679328242"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-35"></span><span>  </span><span id="local-6989586621679328241"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328241"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Env
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-36"></span><span>  </span><span id="local-6989586621679328239"><span class="annot"><span class="annottext">Either Error a
</span><a href="#local-6989586621679328239"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m (Either Error a)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m a -&gt; m (Either e a)
</span><a href="Jikka.Common.Error.html#catchError%27"><span class="hs-identifier hs-var">catchError'</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679328242"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><span class="annottext">Env -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328241"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="annottext">Either Error a -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span> </span><span class="annot"><span class="annottext">Either Error a
</span><a href="#local-6989586621679328239"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span id="local-6989586621679328234"><span id="local-6989586621679328235"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#withScope"><span class="hs-identifier hs-type">withScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328235"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328235"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328235"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328234"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328235"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328234"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-41"></span><span id="withScope"><span class="annot"><span class="annottext">withScope :: m a -&gt; m a
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#withScope"><span class="hs-identifier hs-var hs-var">withScope</span></a></span></span><span> </span><span id="local-6989586621679328232"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679328232"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="annottext">(Env -&gt; Env) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((Env -&gt; Env) -&gt; m ()) -&gt; (Env -&gt; Env) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679328230"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328230"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328230"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-44"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentMapping :: [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var">currentMapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><span class="annottext">parentMappings :: [[(VarName, VarName)]]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#parentMappings"><span class="hs-identifier hs-var">parentMappings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var hs-var">currentMapping</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328230"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[(VarName, VarName)]
-&gt; [[(VarName, VarName)]] -&gt; [[(VarName, VarName)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; [[(VarName, VarName)]]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#parentMappings"><span class="hs-identifier hs-var hs-var">parentMappings</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328230"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-47"></span><span>  </span><span id="local-6989586621679328229"><span class="annot"><span class="annottext">Either Error a
</span><a href="#local-6989586621679328229"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m (Either Error a)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m a -&gt; m (Either e a)
</span><a href="Jikka.Common.Error.html#catchError%27"><span class="hs-identifier hs-var">catchError'</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679328232"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><span class="annottext">(Env -&gt; Env) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((Env -&gt; Env) -&gt; m ()) -&gt; (Env -&gt; Env) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679328228"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328228"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328228"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-50"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentMapping :: [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var">currentMapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(VarName, VarName)]] -&gt; [(VarName, VarName)]
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; [[(VarName, VarName)]]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#parentMappings"><span class="hs-identifier hs-var hs-var">parentMappings</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328228"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><span class="annottext">parentMappings :: [[(VarName, VarName)]]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#parentMappings"><span class="hs-identifier hs-var">parentMappings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(VarName, VarName)]] -&gt; [[(VarName, VarName)]]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; [[(VarName, VarName)]]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#parentMappings"><span class="hs-identifier hs-var hs-var">parentMappings</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328228"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="annottext">Either Error a -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span> </span><span class="annot"><span class="annottext">Either Error a
</span><a href="#local-6989586621679328229"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- | `renameNew` renames given variables and record them to the `Env`.</span><span>
</span><span id="line-56"></span><span id="local-6989586621679328371"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameNew"><span class="hs-identifier hs-type">renameNew</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328371"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328371"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328371"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span></span><span>
</span><span id="line-57"></span><span id="renameNew"><span class="annot"><span class="annottext">renameNew :: VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameNew"><span class="hs-identifier hs-var hs-var">renameNew</span></a></span></span><span> </span><span id="local-6989586621679328224"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328224"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-58"></span><span>  </span><span id="local-6989586621679328223"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328223"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Env
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; Env -&gt; Maybe VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328224"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328223"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">currentMapping :: [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var">currentMapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679328221"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328221"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328221"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="annottext">Maybe VarName'
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>      </span><span id="local-6989586621679328220"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328220"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *). MonadAlpha m =&gt; VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Language.Util.html#genVarName"><span class="hs-identifier hs-var">genVarName</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328224"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-63"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; String
</span><a href="Jikka.RestrictedPython.Language.Expr.html#unVarName"><span class="hs-identifier hs-var">unVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328224"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><span class="annottext">Env -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(Env -&gt; m ()) -&gt; Env -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-65"></span><span>          </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328223"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-66"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentMapping :: [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var">currentMapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328224"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328220"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VarName, VarName) -&gt; [(VarName, VarName)] -&gt; [(VarName, VarName)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var hs-var">currentMapping</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328223"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-67"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-68"></span><span>      </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328220"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | `renameShadow` renames given variables ignoring the current `Env` and record them to the `Env`.</span><span>
</span><span id="line-71"></span><span id="local-6989586621679328214"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameShadow"><span class="hs-identifier hs-type">renameShadow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328214"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328214"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328214"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span></span><span>
</span><span id="line-72"></span><span id="renameShadow"><span class="annot"><span class="annottext">renameShadow :: VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameShadow"><span class="hs-identifier hs-var hs-var">renameShadow</span></a></span></span><span> </span><span id="local-6989586621679328212"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328212"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621679328211"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328211"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Env
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-74"></span><span>  </span><span id="local-6989586621679328210"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328210"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *). MonadAlpha m =&gt; VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Language.Util.html#genVarName"><span class="hs-identifier hs-var">genVarName</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328212"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="annottext">Env -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(Env -&gt; m ()) -&gt; Env -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328211"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentMapping :: [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var">currentMapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328212"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328210"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VarName, VarName) -&gt; [(VarName, VarName)] -&gt; [(VarName, VarName)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var hs-var">currentMapping</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328211"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-78"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328210"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | `renameCompletelyNew` throws errors when given variables already exists in environments.</span><span>
</span><span id="line-82"></span><span id="local-6989586621679328356"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameCompletelyNew"><span class="hs-identifier hs-type">renameCompletelyNew</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328356"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328356"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328356"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span></span><span>
</span><span id="line-83"></span><span id="renameCompletelyNew"><span class="annot"><span class="annottext">renameCompletelyNew :: VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameCompletelyNew"><span class="hs-identifier hs-var hs-var">renameCompletelyNew</span></a></span></span><span> </span><span id="local-6989586621679328208"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328208"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621679328207"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328207"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Env
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; Env -&gt; Maybe VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328208"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328207"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(m VarName' -&gt; m VarName')
-&gt; (Loc -&gt; m VarName' -&gt; m VarName')
-&gt; Maybe Loc
-&gt; m VarName'
-&gt; m VarName'
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">m VarName' -&gt; m VarName'
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; m VarName' -&gt; m VarName'
forall (m :: * -&gt; *) a. MonadError Error m =&gt; Loc -&gt; m a -&gt; m a
</span><a href="Jikka.Common.Error.html#wrapAt"><span class="hs-identifier hs-var">wrapAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; Maybe Loc
forall a. WithLoc' a -&gt; Maybe Loc
</span><a href="Jikka.Common.Location.html#loc%27"><span class="hs-identifier hs-var hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328208"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m VarName' -&gt; m VarName')
-&gt; (String -&gt; m VarName') -&gt; String -&gt; m VarName'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m VarName'
forall (m :: * -&gt; *) a. MonadError Error m =&gt; String -&gt; m a
</span><a href="Jikka.Common.Error.html#throwSemanticError"><span class="hs-identifier hs-var">throwSemanticError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m VarName') -&gt; String -&gt; m VarName'
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot redefine variable: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; String
</span><a href="Jikka.RestrictedPython.Language.Expr.html#unVarName"><span class="hs-identifier hs-var">unVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328208"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="annottext">Maybe VarName'
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameNew"><span class="hs-identifier hs-var">renameNew</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328208"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | `renameToplevel` records given variables to the `Env` without actual renaming.</span><span>
</span><span id="line-90"></span><span id="local-6989586621679328200"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameToplevel"><span class="hs-identifier hs-type">renameToplevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328200"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328200"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328200"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328200"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span></span><span>
</span><span id="line-91"></span><span id="renameToplevel"><span class="annot"><span class="annottext">renameToplevel :: VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameToplevel"><span class="hs-identifier hs-var hs-var">renameToplevel</span></a></span></span><span> </span><span id="local-6989586621679328198"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>  </span><span id="local-6989586621679328197"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328197"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Env
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; Env -&gt; Maybe VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328197"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679328196"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621679328196"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Set VarName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VarName
</span><a href="Jikka.RestrictedPython.Language.Builtin.html#builtinNames"><span class="hs-identifier hs-var">builtinNames</span></a></span><span>
</span><span id="line-97"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot assign to builtin function: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; String
</span><a href="Jikka.RestrictedPython.Language.Expr.html#unVarName"><span class="hs-identifier hs-var">unVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot redefine variable in toplevel: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; String
</span><a href="Jikka.RestrictedPython.Language.Expr.html#unVarName"><span class="hs-identifier hs-var">unVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><span class="annottext">(m VarName' -&gt; m VarName')
-&gt; (Loc -&gt; m VarName' -&gt; m VarName')
-&gt; Maybe Loc
-&gt; m VarName'
-&gt; m VarName'
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">m VarName' -&gt; m VarName'
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; m VarName' -&gt; m VarName'
forall (m :: * -&gt; *) a. MonadError Error m =&gt; Loc -&gt; m a -&gt; m a
</span><a href="Jikka.Common.Error.html#wrapAt"><span class="hs-identifier hs-var">wrapAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; Maybe Loc
forall a. WithLoc' a -&gt; Maybe Loc
</span><a href="Jikka.Common.Location.html#loc%27"><span class="hs-identifier hs-var hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m VarName' -&gt; m VarName') -&gt; m VarName' -&gt; m VarName'
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m VarName'
forall (m :: * -&gt; *) a. MonadError Error m =&gt; String -&gt; m a
</span><a href="Jikka.Common.Error.html#throwSemanticError"><span class="hs-identifier hs-var">throwSemanticError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679328196"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">Maybe VarName'
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; String
</span><a href="Jikka.RestrictedPython.Language.Expr.html#unVarName"><span class="hs-identifier hs-var">unVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>        </span><span class="annot"><span class="annottext">Env -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(Env -&gt; m ()) -&gt; Env -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-103"></span><span>          </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328197"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentMapping :: [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var">currentMapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VarName, VarName) -&gt; [(VarName, VarName)] -&gt; [(VarName, VarName)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var hs-var">currentMapping</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328197"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-105"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328198"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | `renameToplevelArgument` always introduces a new variable.</span><span>
</span><span id="line-109"></span><span id="local-6989586621679328194"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameToplevelArgument"><span class="hs-identifier hs-type">renameToplevelArgument</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328194"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328194"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328194"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328194"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span></span><span>
</span><span id="line-110"></span><span id="renameToplevelArgument"><span class="annot"><span class="annottext">renameToplevelArgument :: VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameToplevelArgument"><span class="hs-identifier hs-var hs-var">renameToplevelArgument</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameShadow"><span class="hs-identifier hs-var">renameShadow</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span id="local-6989586621679328338"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#popRename"><span class="hs-identifier hs-type">popRename</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328338"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328338"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-113"></span><span id="popRename"><span class="annot"><span class="annottext">popRename :: VarName' -&gt; m ()
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#popRename"><span class="hs-identifier hs-var hs-var">popRename</span></a></span></span><span> </span><span id="local-6989586621679328191"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328191"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; String
</span><a href="Jikka.RestrictedPython.Language.Expr.html#unVarName"><span class="hs-identifier hs-var">unVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328191"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679328190"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328190"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadState Env m, MonadError Error m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName%27"><span class="hs-identifier hs-var">lookupName'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328191"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">(Env -&gt; Env) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((Env -&gt; Env) -&gt; m ()) -&gt; (Env -&gt; Env) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679328188"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328188"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328188"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">currentMapping :: [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var">currentMapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarName, VarName) -&gt; [(VarName, VarName)] -&gt; [(VarName, VarName)]
forall a. Eq a =&gt; a -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">delete</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328191"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328190"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var hs-var">currentMapping</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328188"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName"><span class="hs-identifier hs-type">lookupName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span>
</span><span id="line-119"></span><span id="lookupName"><span class="annot"><span class="annottext">lookupName :: VarName' -&gt; Env -&gt; Maybe VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName"><span class="hs-identifier hs-var hs-var">lookupName</span></a></span></span><span> </span><span id="local-6989586621679328187"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328187"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679328186"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328186"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(VarName, VarName)]] -&gt; Maybe VarName'
forall a. [[(VarName, a)]] -&gt; Maybe (WithLoc' a)
</span><a href="#local-6989586621679328185"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; [(VarName, VarName)]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#currentMapping"><span class="hs-identifier hs-var hs-var">currentMapping</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328186"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[(VarName, VarName)]
-&gt; [[(VarName, VarName)]] -&gt; [[(VarName, VarName)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; [[(VarName, VarName)]]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#parentMappings"><span class="hs-identifier hs-var hs-var">parentMappings</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328186"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621679328185"><span class="annot"><span class="annottext">go :: [[(VarName, a)]] -&gt; Maybe (WithLoc' a)
</span><a href="#local-6989586621679328185"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (WithLoc' a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="#local-6989586621679328185"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679328184"><span class="annot"><span class="annottext">[(VarName, a)]
</span><a href="#local-6989586621679328184"><span class="hs-identifier hs-var">mapping</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679328183"><span class="annot"><span class="annottext">[[(VarName, a)]]
</span><a href="#local-6989586621679328183"><span class="hs-identifier hs-var">mappings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarName -&gt; [(VarName, a)] -&gt; Maybe a
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328187"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(VarName, a)]
</span><a href="#local-6989586621679328184"><span class="hs-identifier hs-var">mapping</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679328181"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679328181"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WithLoc' a -&gt; Maybe (WithLoc' a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(WithLoc' a -&gt; Maybe (WithLoc' a))
-&gt; WithLoc' a -&gt; Maybe (WithLoc' a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Loc -&gt; a -&gt; WithLoc' a
forall a. Maybe Loc -&gt; a -&gt; WithLoc' a
</span><a href="Jikka.Common.Location.html#WithLoc%27"><span class="hs-identifier hs-var">WithLoc'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; Maybe Loc
forall a. WithLoc' a -&gt; Maybe Loc
</span><a href="Jikka.Common.Location.html#loc%27"><span class="hs-identifier hs-var hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328187"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679328181"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[(VarName, a)]] -&gt; Maybe (WithLoc' a)
</span><a href="#local-6989586621679328185"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[[(VarName, a)]]
</span><a href="#local-6989586621679328183"><span class="hs-identifier hs-var">mappings</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span id="local-6989586621679328366"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName%27"><span class="hs-identifier hs-type">lookupName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328366"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328366"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328366"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span></span><span>
</span><span id="line-128"></span><span id="lookupName%27"><span class="annot"><span class="annottext">lookupName' :: VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName%27"><span class="hs-identifier hs-var hs-var">lookupName'</span></a></span></span><span> </span><span id="local-6989586621679328179"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328179"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621679328178"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328178"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Env
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; Env -&gt; Maybe VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328179"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679328178"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679328177"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328177"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328177"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">Maybe VarName'
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(m VarName' -&gt; m VarName')
-&gt; (Loc -&gt; m VarName' -&gt; m VarName')
-&gt; Maybe Loc
-&gt; m VarName'
-&gt; m VarName'
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">m VarName' -&gt; m VarName'
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; m VarName' -&gt; m VarName'
forall (m :: * -&gt; *) a. MonadError Error m =&gt; Loc -&gt; m a -&gt; m a
</span><a href="Jikka.Common.Error.html#wrapAt"><span class="hs-identifier hs-var">wrapAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; Maybe Loc
forall a. WithLoc' a -&gt; Maybe Loc
</span><a href="Jikka.Common.Location.html#loc%27"><span class="hs-identifier hs-var hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328179"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m VarName' -&gt; m VarName')
-&gt; (String -&gt; m VarName') -&gt; String -&gt; m VarName'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m VarName'
forall (m :: * -&gt; *) a. MonadError Error m =&gt; String -&gt; m a
</span><a href="Jikka.Common.Error.html#throwSymbolError"><span class="hs-identifier hs-var">throwSymbolError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m VarName') -&gt; String -&gt; m VarName'
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;undefined identifier: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; String
</span><a href="Jikka.RestrictedPython.Language.Expr.html#unVarName"><span class="hs-identifier hs-var">unVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; VarName
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328179"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | `runAnnTarget` renames targets of annotated assignments.</span><span>
</span><span id="line-135"></span><span id="local-6989586621679328175"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runAnnTarget"><span class="hs-identifier hs-type">runAnnTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328175"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328175"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328175"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328175"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span></span><span>
</span><span id="line-136"></span><span id="runAnnTarget"><span class="annot"><span class="annottext">runAnnTarget :: Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runAnnTarget"><span class="hs-identifier hs-var hs-var">runAnnTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
(VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runTargetGeneric"><span class="hs-identifier hs-var">runTargetGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameNew"><span class="hs-identifier hs-var">renameNew</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | `runForTarget` renames targets of for-loops.</span><span>
</span><span id="line-139"></span><span id="local-6989586621679328172"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runForTarget"><span class="hs-identifier hs-type">runForTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328172"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328172"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328172"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328172"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span></span><span>
</span><span id="line-140"></span><span id="runForTarget"><span class="annot"><span class="annottext">runForTarget :: Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runForTarget"><span class="hs-identifier hs-var hs-var">runForTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
(VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runTargetGeneric"><span class="hs-identifier hs-var">runTargetGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m, MonadError Error m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameCompletelyNew"><span class="hs-identifier hs-var">renameCompletelyNew</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- | `runAugTarget` renames targets of augumented assignments.</span><span>
</span><span id="line-143"></span><span id="local-6989586621679328348"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runAugTarget"><span class="hs-identifier hs-type">runAugTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328348"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328348"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328348"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328348"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span></span><span>
</span><span id="line-144"></span><span id="runAugTarget"><span class="annot"><span class="annottext">runAugTarget :: Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runAugTarget"><span class="hs-identifier hs-var hs-var">runAugTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
(VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runTargetGeneric"><span class="hs-identifier hs-var">runTargetGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadState Env m, MonadError Error m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName%27"><span class="hs-identifier hs-var">lookupName'</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span id="local-6989586621679328358"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runTargetGeneric"><span class="hs-identifier hs-type">runTargetGeneric</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328358"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328358"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328358"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328358"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#VarName%27"><span class="hs-identifier hs-type">VarName'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328358"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span></span><span>
</span><span id="line-147"></span><span id="runTargetGeneric"><span class="annot"><span class="annottext">runTargetGeneric :: (VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runTargetGeneric"><span class="hs-identifier hs-var hs-var">runTargetGeneric</span></a></span></span><span> </span><span id="local-6989586621679328169"><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
</span><a href="#local-6989586621679328169"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679328168"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328168"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">Maybe Loc -&gt; Target -&gt; Target'
forall a. Maybe Loc -&gt; a -&gt; WithLoc' a
</span><a href="Jikka.Common.Location.html#WithLoc%27"><span class="hs-identifier hs-var">WithLoc'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Target' -&gt; Maybe Loc
forall a. WithLoc' a -&gt; Maybe Loc
</span><a href="Jikka.Common.Location.html#loc%27"><span class="hs-identifier hs-var hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328168"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Target -&gt; Target') -&gt; m Target -&gt; m Target'
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Target' -&gt; Target
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328168"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#SubscriptTrg"><span class="hs-identifier hs-type">SubscriptTrg</span></a></span><span> </span><span id="local-6989586621679328165"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328165"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679328164"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328164"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Target' -&gt; Expr' -&gt; Target
</span><a href="Jikka.RestrictedPython.Language.Expr.html#SubscriptTrg"><span class="hs-identifier hs-var">SubscriptTrg</span></a></span><span> </span><span class="annot"><span class="annottext">(Target' -&gt; Expr' -&gt; Target) -&gt; m Target' -&gt; m (Expr' -&gt; Target)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runAugTarget"><span class="hs-identifier hs-var">runAugTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328165"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">m (Expr' -&gt; Target) -&gt; m Expr' -&gt; m Target
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328164"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#NameTrg"><span class="hs-identifier hs-type">NameTrg</span></a></span><span> </span><span id="local-6989586621679328161"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328161"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; Target
</span><a href="Jikka.RestrictedPython.Language.Expr.html#NameTrg"><span class="hs-identifier hs-var">NameTrg</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName' -&gt; Target) -&gt; m VarName' -&gt; m Target
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
</span><a href="#local-6989586621679328169"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328161"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#TupleTrg"><span class="hs-identifier hs-type">TupleTrg</span></a></span><span> </span><span id="local-6989586621679328159"><span class="annot"><span class="annottext">[Target']
</span><a href="#local-6989586621679328159"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Target'] -&gt; Target
</span><a href="Jikka.RestrictedPython.Language.Expr.html#TupleTrg"><span class="hs-identifier hs-var">TupleTrg</span></a></span><span> </span><span class="annot"><span class="annottext">([Target'] -&gt; Target) -&gt; m [Target'] -&gt; m Target
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Target' -&gt; m Target') -&gt; [Target'] -&gt; m [Target']
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
(VarName' -&gt; m VarName') -&gt; Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runTargetGeneric"><span class="hs-identifier hs-var">runTargetGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
</span><a href="#local-6989586621679328169"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Target']
</span><a href="#local-6989586621679328159"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span id="local-6989586621679328333"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#popTarget"><span class="hs-identifier hs-type">popTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328333"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328333"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Target%27"><span class="hs-identifier hs-type">Target'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328333"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-154"></span><span id="popTarget"><span class="annot"><span class="annottext">popTarget :: Target' -&gt; m ()
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#popTarget"><span class="hs-identifier hs-var hs-var">popTarget</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Common.Location.html#WithLoc%27"><span class="hs-identifier hs-type">WithLoc'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679328156"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679328156"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679328156"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#SubscriptTrg"><span class="hs-identifier hs-type">SubscriptTrg</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#NameTrg"><span class="hs-identifier hs-type">NameTrg</span></a></span><span> </span><span id="local-6989586621679328155"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328155"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m ()
forall (m :: * -&gt; *).
(MonadState Env m, MonadError Error m) =&gt;
VarName' -&gt; m ()
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#popRename"><span class="hs-identifier hs-var">popRename</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328155"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#TupleTrg"><span class="hs-identifier hs-type">TupleTrg</span></a></span><span> </span><span id="local-6989586621679328154"><span class="annot"><span class="annottext">[Target']
</span><a href="#local-6989586621679328154"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Target' -&gt; m ()) -&gt; [Target'] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Target' -&gt; m ()
forall (m :: * -&gt; *).
(MonadState Env m, MonadError Error m) =&gt;
Target' -&gt; m ()
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#popTarget"><span class="hs-identifier hs-var">popTarget</span></a></span><span> </span><span class="annot"><span class="annottext">[Target']
</span><a href="#local-6989586621679328154"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621679328344"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-type">runExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328344"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328344"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328344"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Expr%27"><span class="hs-identifier hs-type">Expr'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328344"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Expr%27"><span class="hs-identifier hs-type">Expr'</span></a></span></span><span>
</span><span id="line-160"></span><span id="runExpr"><span class="annot"><span class="annottext">runExpr :: Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var hs-var">runExpr</span></a></span></span><span> </span><span id="local-6989586621679328152"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328152"><span class="hs-identifier hs-var">e0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="annottext">(m Expr' -&gt; m Expr')
-&gt; (Loc -&gt; m Expr' -&gt; m Expr') -&gt; Maybe Loc -&gt; m Expr' -&gt; m Expr'
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">m Expr' -&gt; m Expr'
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; m Expr' -&gt; m Expr'
forall (m :: * -&gt; *) a. MonadError Error m =&gt; Loc -&gt; m a -&gt; m a
</span><a href="Jikka.Common.Error.html#wrapAt"><span class="hs-identifier hs-var">wrapAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr' -&gt; Maybe Loc
forall a. WithLoc' a -&gt; Maybe Loc
</span><a href="Jikka.Common.Location.html#loc%27"><span class="hs-identifier hs-var hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328152"><span class="hs-identifier hs-var">e0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m Expr' -&gt; m Expr') -&gt; m Expr' -&gt; m Expr'
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">Maybe Loc -&gt; Expr -&gt; Expr'
forall a. Maybe Loc -&gt; a -&gt; WithLoc' a
</span><a href="Jikka.Common.Location.html#WithLoc%27"><span class="hs-identifier hs-var">WithLoc'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr' -&gt; Maybe Loc
forall a. WithLoc' a -&gt; Maybe Loc
</span><a href="Jikka.Common.Location.html#loc%27"><span class="hs-identifier hs-var hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328152"><span class="hs-identifier hs-var">e0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Expr') -&gt; m Expr -&gt; m Expr'
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; Expr
forall a. WithLoc' a -&gt; a
</span><a href="Jikka.Common.Location.html#value%27"><span class="hs-identifier hs-var hs-var">value'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328152"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#BoolOp"><span class="hs-identifier hs-type">BoolOp</span></a></span><span> </span><span id="local-6989586621679328150"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328150"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679328149"><span class="annot"><span class="annottext">BoolOp
</span><a href="#local-6989586621679328149"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679328148"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328148"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; BoolOp -&gt; Expr' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#BoolOp"><span class="hs-identifier hs-var">BoolOp</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; BoolOp -&gt; Expr' -&gt; Expr)
-&gt; m Expr' -&gt; m (BoolOp -&gt; Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328150"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">m (BoolOp -&gt; Expr' -&gt; Expr) -&gt; m BoolOp -&gt; m (Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">BoolOp -&gt; m BoolOp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">BoolOp
</span><a href="#local-6989586621679328149"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">m (Expr' -&gt; Expr) -&gt; m Expr' -&gt; m Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328148"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#BinOp"><span class="hs-identifier hs-type">BinOp</span></a></span><span> </span><span id="local-6989586621679328146"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328146"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679328145"><span class="annot"><span class="annottext">Operator
</span><a href="#local-6989586621679328145"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679328144"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328144"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; Operator -&gt; Expr' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; Operator -&gt; Expr' -&gt; Expr)
-&gt; m Expr' -&gt; m (Operator -&gt; Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328146"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">m (Operator -&gt; Expr' -&gt; Expr) -&gt; m Operator -&gt; m (Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Operator -&gt; m Operator
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Operator
</span><a href="#local-6989586621679328145"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">m (Expr' -&gt; Expr) -&gt; m Expr' -&gt; m Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328144"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#UnaryOp"><span class="hs-identifier hs-type">UnaryOp</span></a></span><span> </span><span id="local-6989586621679328142"><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679328142"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679328141"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328141"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnaryOp -&gt; Expr' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#UnaryOp"><span class="hs-identifier hs-var">UnaryOp</span></a></span><span> </span><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679328142"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; Expr) -&gt; m Expr' -&gt; m Expr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328141"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621679328139"><span class="annot"><span class="annottext">[(VarName', Type)]
</span><a href="#local-6989586621679328139"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679328138"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328138"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-167"></span><span>        </span><span class="annot"><span class="annottext">m Expr -&gt; m Expr
forall (m :: * -&gt; *) a.
(MonadError Error m, MonadState Env m) =&gt;
m a -&gt; m a
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#withToplevelScope"><span class="hs-identifier hs-var">withToplevelScope</span></a></span><span> </span><span class="annot"><span class="annottext">(m Expr -&gt; m Expr) -&gt; m Expr -&gt; m Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>          </span><span id="local-6989586621679328137"><span class="annot"><span class="annottext">[(VarName', Type)]
</span><a href="#local-6989586621679328137"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(VarName', Type)]
-&gt; ((VarName', Type) -&gt; m (VarName', Type)) -&gt; m [(VarName', Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(VarName', Type)]
</span><a href="#local-6989586621679328139"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(((VarName', Type) -&gt; m (VarName', Type)) -&gt; m [(VarName', Type)])
-&gt; ((VarName', Type) -&gt; m (VarName', Type)) -&gt; m [(VarName', Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679328135"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328135"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679328134"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328134"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>            </span><span id="local-6989586621679328133"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328133"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameNew"><span class="hs-identifier hs-var">renameNew</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328135"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-170"></span><span>            </span><span class="annot"><span class="annottext">(VarName', Type) -&gt; m (VarName', Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328133"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328134"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>          </span><span id="local-6989586621679328132"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328132"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328138"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-172"></span><span>          </span><span class="annot"><span class="annottext">Expr -&gt; m Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; m Expr) -&gt; Expr -&gt; m Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(VarName', Type)] -&gt; Expr' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">[(VarName', Type)]
</span><a href="#local-6989586621679328137"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328132"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#IfExp"><span class="hs-identifier hs-type">IfExp</span></a></span><span> </span><span id="local-6989586621679328130"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328130"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679328129"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328129"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621679328128"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328128"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; Expr' -&gt; Expr' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#IfExp"><span class="hs-identifier hs-var">IfExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; Expr' -&gt; Expr' -&gt; Expr)
-&gt; m Expr' -&gt; m (Expr' -&gt; Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328130"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">m (Expr' -&gt; Expr' -&gt; Expr) -&gt; m Expr' -&gt; m (Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328129"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">m (Expr' -&gt; Expr) -&gt; m Expr' -&gt; m Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328128"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#ListComp"><span class="hs-identifier hs-type">ListComp</span></a></span><span> </span><span id="local-6989586621679328126"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328126"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Comprehension"><span class="hs-identifier hs-type">Comprehension</span></a></span><span> </span><span id="local-6989586621679328124"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328124"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679328123"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328123"><span class="hs-identifier hs-var">iter</span></a></span></span><span> </span><span id="local-6989586621679328122"><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328122"><span class="hs-identifier hs-var">ifs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621679328121"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328121"><span class="hs-identifier hs-var">iter</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328123"><span class="hs-identifier hs-var">iter</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span id="local-6989586621679328120"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328120"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runAnnTarget"><span class="hs-identifier hs-var">runAnnTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328124"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-177"></span><span>        </span><span id="local-6989586621679328119"><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328119"><span class="hs-identifier hs-var">ifs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; m Expr') -&gt; Maybe Expr' -&gt; m (Maybe Expr')
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328122"><span class="hs-identifier hs-var">ifs</span></a></span><span>
</span><span id="line-178"></span><span>        </span><span id="local-6989586621679328118"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328118"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328126"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">Target' -&gt; m ()
forall (m :: * -&gt; *).
(MonadState Env m, MonadError Error m) =&gt;
Target' -&gt; m ()
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#popTarget"><span class="hs-identifier hs-var">popTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328124"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; m Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; m Expr) -&gt; Expr -&gt; m Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; Comprehension -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#ListComp"><span class="hs-identifier hs-var">ListComp</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328118"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Target' -&gt; Expr' -&gt; Maybe Expr' -&gt; Comprehension
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Comprehension"><span class="hs-identifier hs-var">Comprehension</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328120"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328121"><span class="hs-identifier hs-var">iter</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328119"><span class="hs-identifier hs-var">ifs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Compare"><span class="hs-identifier hs-type">Compare</span></a></span><span> </span><span id="local-6989586621679328116"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328116"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679328115"><span class="annot"><span class="annottext">CmpOp'
</span><a href="#local-6989586621679328115"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679328114"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328114"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; CmpOp' -&gt; Expr' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Compare"><span class="hs-identifier hs-var">Compare</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; CmpOp' -&gt; Expr' -&gt; Expr)
-&gt; m Expr' -&gt; m (CmpOp' -&gt; Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328116"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">m (CmpOp' -&gt; Expr' -&gt; Expr) -&gt; m CmpOp' -&gt; m (Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">CmpOp' -&gt; m CmpOp'
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CmpOp'
</span><a href="#local-6989586621679328115"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">m (Expr' -&gt; Expr) -&gt; m Expr' -&gt; m Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328114"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621679328112"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328112"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679328111"><span class="annot"><span class="annottext">[Expr']
</span><a href="#local-6989586621679328111"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; [Expr'] -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; [Expr'] -&gt; Expr) -&gt; m Expr' -&gt; m ([Expr'] -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328112"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">m ([Expr'] -&gt; Expr) -&gt; m [Expr'] -&gt; m Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; m Expr') -&gt; [Expr'] -&gt; m [Expr']
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr']
</span><a href="#local-6989586621679328111"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span id="local-6989586621679328109"><span class="annot"><span class="annottext">Constant
</span><a href="#local-6989586621679328109"><span class="hs-identifier hs-var">const</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; m Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; m Expr) -&gt; Expr -&gt; m Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">Constant
</span><a href="#local-6989586621679328109"><span class="hs-identifier hs-var">const</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Subscript"><span class="hs-identifier hs-type">Subscript</span></a></span><span> </span><span id="local-6989586621679328107"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328107"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679328106"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328106"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; Expr' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Subscript"><span class="hs-identifier hs-var">Subscript</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; Expr' -&gt; Expr) -&gt; m Expr' -&gt; m (Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328107"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">m (Expr' -&gt; Expr) -&gt; m Expr' -&gt; m Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328106"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span id="local-6989586621679328104"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328104"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Name"><span class="hs-identifier hs-var">Name</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName' -&gt; Expr) -&gt; m VarName' -&gt; m Expr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadState Env m, MonadError Error m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#lookupName%27"><span class="hs-identifier hs-var">lookupName'</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328104"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#List"><span class="hs-identifier hs-type">List</span></a></span><span> </span><span id="local-6989586621679328102"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328102"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679328101"><span class="annot"><span class="annottext">[Expr']
</span><a href="#local-6989586621679328101"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Expr'] -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328102"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">([Expr'] -&gt; Expr) -&gt; m [Expr'] -&gt; m Expr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; m Expr') -&gt; [Expr'] -&gt; m [Expr']
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr']
</span><a href="#local-6989586621679328101"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Tuple"><span class="hs-identifier hs-type">Tuple</span></a></span><span> </span><span id="local-6989586621679328099"><span class="annot"><span class="annottext">[Expr']
</span><a href="#local-6989586621679328099"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Expr'] -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="annot"><span class="annottext">([Expr'] -&gt; Expr) -&gt; m [Expr'] -&gt; m Expr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; m Expr') -&gt; [Expr'] -&gt; m [Expr']
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr']
</span><a href="#local-6989586621679328099"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#SubscriptSlice"><span class="hs-identifier hs-type">SubscriptSlice</span></a></span><span> </span><span id="local-6989586621679328097"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328097"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679328096"><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328096"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621679328095"><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328095"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span id="local-6989586621679328094"><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328094"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; Maybe Expr' -&gt; Maybe Expr' -&gt; Maybe Expr' -&gt; Expr
</span><a href="Jikka.RestrictedPython.Language.Expr.html#SubscriptSlice"><span class="hs-identifier hs-var">SubscriptSlice</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; Maybe Expr' -&gt; Maybe Expr' -&gt; Maybe Expr' -&gt; Expr)
-&gt; m Expr' -&gt; m (Maybe Expr' -&gt; Maybe Expr' -&gt; Maybe Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328097"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe Expr' -&gt; Maybe Expr' -&gt; Maybe Expr' -&gt; Expr)
-&gt; m (Maybe Expr') -&gt; m (Maybe Expr' -&gt; Maybe Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; m Expr') -&gt; Maybe Expr' -&gt; m (Maybe Expr')
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328096"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe Expr' -&gt; Maybe Expr' -&gt; Expr)
-&gt; m (Maybe Expr') -&gt; m (Maybe Expr' -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; m Expr') -&gt; Maybe Expr' -&gt; m (Maybe Expr')
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328095"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe Expr' -&gt; Expr) -&gt; m (Maybe Expr') -&gt; m Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; m Expr') -&gt; Maybe Expr' -&gt; m (Maybe Expr')
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr'
</span><a href="#local-6989586621679328094"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span id="local-6989586621679328305"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatement"><span class="hs-identifier hs-type">runStatement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328305"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328305"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328305"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Statement"><span class="hs-identifier hs-type">Statement</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328305"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Statement"><span class="hs-identifier hs-type">Statement</span></a></span></span><span>
</span><span id="line-191"></span><span id="runStatement"><span class="annot"><span class="annottext">runStatement :: Statement -&gt; m Statement
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatement"><span class="hs-identifier hs-var hs-var">runStatement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679328091"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328091"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; Statement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; Statement) -&gt; m Expr' -&gt; m Statement
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328091"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#AugAssign"><span class="hs-identifier hs-type">AugAssign</span></a></span><span> </span><span id="local-6989586621679328089"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328089"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679328088"><span class="annot"><span class="annottext">Operator
</span><a href="#local-6989586621679328088"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679328087"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328087"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679328086"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328086"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328087"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679328085"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328085"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runAugTarget"><span class="hs-identifier hs-var">runAugTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328089"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">Statement -&gt; m Statement
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Statement -&gt; m Statement) -&gt; Statement -&gt; m Statement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Target' -&gt; Operator -&gt; Expr' -&gt; Statement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#AugAssign"><span class="hs-identifier hs-var">AugAssign</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328085"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operator
</span><a href="#local-6989586621679328088"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328086"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#AnnAssign"><span class="hs-identifier hs-type">AnnAssign</span></a></span><span> </span><span id="local-6989586621679328083"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328083"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679328082"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328082"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679328081"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328081"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679328080"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328080"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328081"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- visit e before x</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679328079"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328079"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runAnnTarget"><span class="hs-identifier hs-var">runAnnTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328083"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">Statement -&gt; m Statement
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Statement -&gt; m Statement) -&gt; Statement -&gt; m Statement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Target' -&gt; Type -&gt; Expr' -&gt; Statement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#AnnAssign"><span class="hs-identifier hs-var">AnnAssign</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328079"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328082"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328080"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#For"><span class="hs-identifier hs-type">For</span></a></span><span> </span><span id="local-6989586621679328077"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328077"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679328076"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328076"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679328075"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328075"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621679328074"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328074"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328076"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">m Statement -&gt; m Statement
forall (m :: * -&gt; *) a.
(MonadError Error m, MonadState Env m) =&gt;
m a -&gt; m a
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#withScope"><span class="hs-identifier hs-var">withScope</span></a></span><span> </span><span class="annot"><span class="annottext">(m Statement -&gt; m Statement) -&gt; m Statement -&gt; m Statement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>      </span><span id="local-6989586621679328073"><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328073"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Target' -&gt; m Target'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Target' -&gt; m Target'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runForTarget"><span class="hs-identifier hs-var">runForTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328077"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-205"></span><span>      </span><span id="local-6989586621679328072"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328072"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Statement] -&gt; m [Statement]
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
[Statement] -&gt; m [Statement]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatements"><span class="hs-identifier hs-var">runStatements</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328075"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">Statement -&gt; m Statement
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Statement -&gt; m Statement) -&gt; Statement -&gt; m Statement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Target' -&gt; Expr' -&gt; [Statement] -&gt; Statement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#For"><span class="hs-identifier hs-var">For</span></a></span><span> </span><span class="annot"><span class="annottext">Target'
</span><a href="#local-6989586621679328073"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328074"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328072"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621679328069"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328069"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679328068"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328068"><span class="hs-identifier hs-var">body1</span></a></span></span><span> </span><span id="local-6989586621679328067"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328067"><span class="hs-identifier hs-var">body2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679328066"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328066"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328069"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReadList
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.VariableAnalysis.html#WriteList"><span class="hs-identifier hs-type">WriteList</span></a></span><span> </span><span id="local-6989586621679328064"><span class="annot"><span class="annottext">[VarName]
</span><a href="#local-6989586621679328064"><span class="hs-identifier hs-var">w1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Statement] -&gt; (ReadList, WriteList)
</span><a href="Jikka.RestrictedPython.Language.VariableAnalysis.html#analyzeStatementsMin"><span class="hs-identifier hs-var">analyzeStatementsMin</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328068"><span class="hs-identifier hs-var">body1</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReadList
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.VariableAnalysis.html#WriteList"><span class="hs-identifier hs-type">WriteList</span></a></span><span> </span><span id="local-6989586621679328062"><span class="annot"><span class="annottext">[VarName]
</span><a href="#local-6989586621679328062"><span class="hs-identifier hs-var">w2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Statement] -&gt; (ReadList, WriteList)
</span><a href="Jikka.RestrictedPython.Language.VariableAnalysis.html#analyzeStatementsMin"><span class="hs-identifier hs-var">analyzeStatementsMin</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328067"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">(VarName -&gt; m VarName') -&gt; [VarName] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameNew"><span class="hs-identifier hs-var">renameNew</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName' -&gt; m VarName')
-&gt; (VarName -&gt; VarName') -&gt; VarName -&gt; m VarName'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Loc -&gt; VarName -&gt; VarName'
forall a. Maybe Loc -&gt; a -&gt; WithLoc' a
</span><a href="Jikka.Common.Location.html#WithLoc%27"><span class="hs-identifier hs-var">WithLoc'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Loc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VarName]
</span><a href="#local-6989586621679328064"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">[VarName] -&gt; [VarName] -&gt; [VarName]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="annot"><span class="annottext">[VarName]
</span><a href="#local-6989586621679328062"><span class="hs-identifier hs-var">w2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- introduce variables to the parent scope</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679328061"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328061"><span class="hs-identifier hs-var">body1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [Statement] -&gt; m [Statement]
forall (m :: * -&gt; *) a.
(MonadError Error m, MonadState Env m) =&gt;
m a -&gt; m a
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#withScope"><span class="hs-identifier hs-var">withScope</span></a></span><span> </span><span class="annot"><span class="annottext">(m [Statement] -&gt; m [Statement]) -&gt; m [Statement] -&gt; m [Statement]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">[Statement] -&gt; m [Statement]
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
[Statement] -&gt; m [Statement]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatements"><span class="hs-identifier hs-var">runStatements</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328068"><span class="hs-identifier hs-var">body1</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679328060"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328060"><span class="hs-identifier hs-var">body2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [Statement] -&gt; m [Statement]
forall (m :: * -&gt; *) a.
(MonadError Error m, MonadState Env m) =&gt;
m a -&gt; m a
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#withScope"><span class="hs-identifier hs-var">withScope</span></a></span><span> </span><span class="annot"><span class="annottext">(m [Statement] -&gt; m [Statement]) -&gt; m [Statement] -&gt; m [Statement]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>      </span><span class="annot"><span class="annottext">[Statement] -&gt; m [Statement]
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
[Statement] -&gt; m [Statement]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatements"><span class="hs-identifier hs-var">runStatements</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328067"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">Statement -&gt; m Statement
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Statement -&gt; m Statement) -&gt; Statement -&gt; m Statement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; [Statement] -&gt; [Statement] -&gt; Statement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328066"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328061"><span class="hs-identifier hs-var">body1</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328060"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span id="local-6989586621679328058"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328058"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; Statement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; Statement) -&gt; m Expr' -&gt; m Statement
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328058"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="local-6989586621679328315"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatements"><span class="hs-identifier hs-type">runStatements</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328315"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328315"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328315"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Statement"><span class="hs-identifier hs-type">Statement</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328315"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Statement"><span class="hs-identifier hs-type">Statement</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-220"></span><span id="runStatements"><span class="annot"><span class="annottext">runStatements :: [Statement] -&gt; m [Statement]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatements"><span class="hs-identifier hs-var hs-var">runStatements</span></a></span></span><span> </span><span id="local-6989586621679328057"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328057"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either Error Statement] -&gt; m [Statement]
forall (m :: * -&gt; *) a.
MonadError Error m =&gt;
[Either Error a] -&gt; m [a]
</span><a href="Jikka.Common.Error.html#reportErrors"><span class="hs-identifier hs-var">reportErrors</span></a></span><span> </span><span class="annot"><span class="annottext">([Either Error Statement] -&gt; m [Statement])
-&gt; m [Either Error Statement] -&gt; m [Statement]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Statement -&gt; m (Either Error Statement))
-&gt; [Statement] -&gt; m [Either Error Statement]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m Statement -&gt; m (Either Error Statement)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m a -&gt; m (Either e a)
</span><a href="Jikka.Common.Error.html#catchError%27"><span class="hs-identifier hs-var">catchError'</span></a></span><span> </span><span class="annot"><span class="annottext">(m Statement -&gt; m (Either Error Statement))
-&gt; (Statement -&gt; m Statement)
-&gt; Statement
-&gt; m (Either Error Statement)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Statement -&gt; m Statement
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Statement -&gt; m Statement
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatement"><span class="hs-identifier hs-var">runStatement</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328057"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span id="local-6989586621679328300"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runToplevelStatement"><span class="hs-identifier hs-type">runToplevelStatement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328300"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328300"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328300"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#ToplevelStatement"><span class="hs-identifier hs-type">ToplevelStatement</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328300"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#ToplevelStatement"><span class="hs-identifier hs-type">ToplevelStatement</span></a></span></span><span>
</span><span id="line-223"></span><span id="runToplevelStatement"><span class="annot"><span class="annottext">runToplevelStatement :: ToplevelStatement -&gt; m ToplevelStatement
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runToplevelStatement"><span class="hs-identifier hs-var hs-var">runToplevelStatement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-224"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#ToplevelAnnAssign"><span class="hs-identifier hs-type">ToplevelAnnAssign</span></a></span><span> </span><span id="local-6989586621679328052"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328052"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679328051"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328051"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679328050"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328050"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679328049"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328049"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328050"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- visit e before x</span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621679328048"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328048"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m, MonadError Error m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameToplevel"><span class="hs-identifier hs-var">renameToplevel</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="annottext">ToplevelStatement -&gt; m ToplevelStatement
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ToplevelStatement -&gt; m ToplevelStatement)
-&gt; ToplevelStatement -&gt; m ToplevelStatement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; Type -&gt; Expr' -&gt; ToplevelStatement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#ToplevelAnnAssign"><span class="hs-identifier hs-var">ToplevelAnnAssign</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328048"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328051"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328049"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#ToplevelFunctionDef"><span class="hs-identifier hs-type">ToplevelFunctionDef</span></a></span><span> </span><span id="local-6989586621679328046"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328046"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679328045"><span class="annot"><span class="annottext">[(VarName', Type)]
</span><a href="#local-6989586621679328045"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679328044"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328044"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span id="local-6989586621679328043"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328043"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621679328042"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328042"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m, MonadError Error m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameToplevel"><span class="hs-identifier hs-var">renameToplevel</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328046"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">m ToplevelStatement -&gt; m ToplevelStatement
forall (m :: * -&gt; *) a.
(MonadError Error m, MonadState Env m) =&gt;
m a -&gt; m a
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#withToplevelScope"><span class="hs-identifier hs-var">withToplevelScope</span></a></span><span> </span><span class="annot"><span class="annottext">(m ToplevelStatement -&gt; m ToplevelStatement)
-&gt; m ToplevelStatement -&gt; m ToplevelStatement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>      </span><span id="local-6989586621679328041"><span class="annot"><span class="annottext">[(VarName', Type)]
</span><a href="#local-6989586621679328041"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(VarName', Type)]
-&gt; ((VarName', Type) -&gt; m (VarName', Type)) -&gt; m [(VarName', Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(VarName', Type)]
</span><a href="#local-6989586621679328045"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(((VarName', Type) -&gt; m (VarName', Type)) -&gt; m [(VarName', Type)])
-&gt; ((VarName', Type) -&gt; m (VarName', Type)) -&gt; m [(VarName', Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679328040"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328040"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679328039"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328039"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>        </span><span id="local-6989586621679328038"><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328038"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName' -&gt; m VarName'
forall (m :: * -&gt; *).
(MonadAlpha m, MonadState Env m, MonadError Error m) =&gt;
VarName' -&gt; m VarName'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#renameToplevelArgument"><span class="hs-identifier hs-var">renameToplevelArgument</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328040"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">(VarName', Type) -&gt; m (VarName', Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328038"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328039"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>      </span><span id="local-6989586621679328037"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328037"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Statement] -&gt; m [Statement]
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
[Statement] -&gt; m [Statement]
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runStatements"><span class="hs-identifier hs-var">runStatements</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328043"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><span class="annottext">ToplevelStatement -&gt; m ToplevelStatement
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ToplevelStatement -&gt; m ToplevelStatement)
-&gt; ToplevelStatement -&gt; m ToplevelStatement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName'
-&gt; [(VarName', Type)] -&gt; Type -&gt; [Statement] -&gt; ToplevelStatement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#ToplevelFunctionDef"><span class="hs-identifier hs-var">ToplevelFunctionDef</span></a></span><span> </span><span class="annot"><span class="annottext">VarName'
</span><a href="#local-6989586621679328042"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">[(VarName', Type)]
</span><a href="#local-6989586621679328041"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679328044"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679328037"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#ToplevelAssert"><span class="hs-identifier hs-type">ToplevelAssert</span></a></span><span> </span><span id="local-6989586621679328035"><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328035"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; ToplevelStatement
</span><a href="Jikka.RestrictedPython.Language.Expr.html#ToplevelAssert"><span class="hs-identifier hs-var">ToplevelAssert</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr' -&gt; ToplevelStatement) -&gt; m Expr' -&gt; m ToplevelStatement
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' -&gt; m Expr'
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Expr' -&gt; m Expr'
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runExpr"><span class="hs-identifier hs-var">runExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr'
</span><a href="#local-6989586621679328035"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span id="local-6989586621679328291"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#runProgram"><span class="hs-identifier hs-type">runProgram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328291"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328291"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328291"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328291"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Program"><span class="hs-identifier hs-type">Program</span></a></span></span><span>
</span><span id="line-239"></span><span id="runProgram"><span class="annot"><span class="annottext">runProgram :: Program -&gt; m Program
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runProgram"><span class="hs-identifier hs-var hs-var">runProgram</span></a></span></span><span> </span><span id="local-6989586621679328033"><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679328033"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either Error ToplevelStatement] -&gt; m Program
forall (m :: * -&gt; *) a.
MonadError Error m =&gt;
[Either Error a] -&gt; m [a]
</span><a href="Jikka.Common.Error.html#reportErrors"><span class="hs-identifier hs-var">reportErrors</span></a></span><span> </span><span class="annot"><span class="annottext">([Either Error ToplevelStatement] -&gt; m Program)
-&gt; m [Either Error ToplevelStatement] -&gt; m Program
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(ToplevelStatement -&gt; m (Either Error ToplevelStatement))
-&gt; Program -&gt; m [Either Error ToplevelStatement]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m ToplevelStatement -&gt; m (Either Error ToplevelStatement)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m a -&gt; m (Either e a)
</span><a href="Jikka.Common.Error.html#catchError%27"><span class="hs-identifier hs-var">catchError'</span></a></span><span> </span><span class="annot"><span class="annottext">(m ToplevelStatement -&gt; m (Either Error ToplevelStatement))
-&gt; (ToplevelStatement -&gt; m ToplevelStatement)
-&gt; ToplevelStatement
-&gt; m (Either Error ToplevelStatement)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ToplevelStatement -&gt; m ToplevelStatement
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
ToplevelStatement -&gt; m ToplevelStatement
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runToplevelStatement"><span class="hs-identifier hs-var">runToplevelStatement</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679328033"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">-- | `run` renames variables.</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- This assumes `doesntHaveAssignmentToBuiltin`.</span><span>
</span><span id="line-243"></span><span class="hs-comment">--</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- * This introduce a new name for each assignment if possible.</span><span>
</span><span id="line-245"></span><span class="hs-comment">--   For example, the following</span><span>
</span><span id="line-246"></span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span class="hs-comment">--   &gt; x = 21</span><span>
</span><span id="line-248"></span><span class="hs-comment">--   &gt; x += x</span><span>
</span><span id="line-249"></span><span class="hs-comment">--   &gt; x = 42</span><span>
</span><span id="line-250"></span><span class="hs-comment">--   &gt; x += x</span><span>
</span><span id="line-251"></span><span class="hs-comment">--   &gt; for _ in range(100):</span><span>
</span><span id="line-252"></span><span class="hs-comment">--   &gt;     x = x + 1</span><span>
</span><span id="line-253"></span><span class="hs-comment">--   &gt; x = x + 1</span><span>
</span><span id="line-254"></span><span class="hs-comment">--</span><span>
</span><span id="line-255"></span><span class="hs-comment">--   turns the following</span><span>
</span><span id="line-256"></span><span class="hs-comment">--</span><span>
</span><span id="line-257"></span><span class="hs-comment">--   &gt; x0 = 21</span><span>
</span><span id="line-258"></span><span class="hs-comment">--   &gt; x1 += x0</span><span>
</span><span id="line-259"></span><span class="hs-comment">--   &gt; x2 = 42</span><span>
</span><span id="line-260"></span><span class="hs-comment">--   &gt; x3 += x2</span><span>
</span><span id="line-261"></span><span class="hs-comment">--   &gt; for a4 in range(100):</span><span>
</span><span id="line-262"></span><span class="hs-comment">--   &gt;     x3 = x3 + 1</span><span>
</span><span id="line-263"></span><span class="hs-comment">--   &gt; x5 = x3 + 1</span><span>
</span><span id="line-264"></span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- * This blames leaks of loop counters of for-statements, i.e. `doesntHaveLeakOfLoopCounters`.</span><span>
</span><span id="line-266"></span><span class="hs-comment">--   For example, the followings is not allowed.</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">--   &gt; for i in range(10):</span><span>
</span><span id="line-269"></span><span class="hs-comment">--   &gt;     a = 0</span><span>
</span><span id="line-270"></span><span class="hs-comment">--   &gt; return a  # error</span><span>
</span><span id="line-271"></span><span class="hs-comment">--</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- * This blames leaks of names from for-statements and if-statements at all.</span><span>
</span><span id="line-273"></span><span class="hs-comment">--   For example, the followings are not allowed.</span><span>
</span><span id="line-274"></span><span class="hs-comment">--</span><span>
</span><span id="line-275"></span><span class="hs-comment">--   &gt; if True:</span><span>
</span><span id="line-276"></span><span class="hs-comment">--   &gt;     a = 0</span><span>
</span><span id="line-277"></span><span class="hs-comment">--   &gt; else:</span><span>
</span><span id="line-278"></span><span class="hs-comment">--   &gt;     b = 1</span><span>
</span><span id="line-279"></span><span class="hs-comment">--   &gt; return a  # error</span><span>
</span><span id="line-280"></span><span class="hs-comment">--</span><span>
</span><span id="line-281"></span><span class="hs-comment">--   &gt; for i in range(10):</span><span>
</span><span id="line-282"></span><span class="hs-comment">--   &gt;     a = 0</span><span>
</span><span id="line-283"></span><span class="hs-comment">--   &gt; return a  # error</span><span>
</span><span id="line-284"></span><span id="local-6989586621679328032"><span class="annot"><a href="Jikka.RestrictedPython.Convert.Alpha.html#run"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Common.Alpha.html#MonadAlpha"><span class="hs-identifier hs-type">MonadAlpha</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328032"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Jikka.Common.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679328032"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679328032"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Jikka.RestrictedPython.Language.Expr.html#Program"><span class="hs-identifier hs-type">Program</span></a></span></span><span>
</span><span id="line-285"></span><span id="run"><span class="annot"><span class="annottext">run :: Program -&gt; m Program
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span id="local-6989586621679328031"><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679328031"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m Program -&gt; m Program
forall (m :: * -&gt; *) a. MonadError Error m =&gt; String -&gt; m a -&gt; m a
</span><a href="Jikka.Common.Error.html#wrapError%27"><span class="hs-identifier hs-var">wrapError'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Jikka.RestrictedPython.Convert.Alpha&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m Program -&gt; m Program) -&gt; m Program -&gt; m Program
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="annottext">Program -&gt; m ()
forall (m :: * -&gt; *). MonadError Error m =&gt; Program -&gt; m ()
</span><a href="Jikka.RestrictedPython.Language.Lint.html#ensureDoesntHaveLeakOfLoopCounters"><span class="hs-identifier hs-var">ensureDoesntHaveLeakOfLoopCounters</span></a></span><span> </span><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679328031"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="annottext">Program -&gt; m ()
forall (m :: * -&gt; *). MonadError Error m =&gt; Program -&gt; m ()
</span><a href="Jikka.RestrictedPython.Language.Lint.html#ensureDoesntHaveAssignmentToBuiltin"><span class="hs-identifier hs-var">ensureDoesntHaveAssignmentToBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679328031"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="annottext">StateT Env m Program -&gt; Env -&gt; m Program
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Program -&gt; StateT Env m Program
forall (m :: * -&gt; *).
(MonadState Env m, MonadAlpha m, MonadError Error m) =&gt;
Program -&gt; m Program
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#runProgram"><span class="hs-identifier hs-var">runProgram</span></a></span><span> </span><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679328031"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="Jikka.RestrictedPython.Convert.Alpha.html#initialEnv"><span class="hs-identifier hs-var">initialEnv</span></a></span><span>
</span><span id="line-289"></span></pre></body></html>